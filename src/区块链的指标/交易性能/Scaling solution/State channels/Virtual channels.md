# Virtual channels

在这篇文章里，我们描述一种状态通道的架构叫做“虚拟通道”，它是唯一支持像付费文件的流式支付之类的架构。虚拟通道可以简化去中心化系统中图式结构的交易查询、Filecoin 内容检索、状态通道网络中的奖励机制等。

## 动机

让我们设计一种不需要信任的支付系统，用于在分布式储存系统中下载文件。如果使用以太坊的主网络，每下载文件的一个小部分，都需要支付最低 2 美元的手续费，而且以太坊每秒钟只能完成 50 笔交易。Optimistic 和 ZK Rollups 都可以增加系统的吞吐量、降低手续费。StarkEx 的 ZK Rollups 支持每秒钟 3000 笔交易的速度，手续费低至 0.03 美元。假如我们要用 1 美元的钱去下载 1GB 的文件，一个文件的分片大小是 256KB，将会产生 5000 笔交易。在网速是 20MB 每秒的情况下，用户需要以 0.0002 的手续费每秒完成 80 笔交易。Rollups 的交易速度好像稍微不太够，手续费更是超出预期了。（画外音：每秒 20MB 是什么神仙网速，羡慕 T_T）

对于这样吞吐量和手续费的需求，状态通道的方案开了一个好头。状态通道可以在打开通道后，尽情在通道的两个节点间进行交易，吞吐量只受限于网络带宽。唯一的挑战就是节点需要和其他很多个节点打开通道，打开通道的过程本身是主要和主网络交互的，也是一笔昂贵的开销。

虚拟通道是我们用来解决这些问题设计出的方案。虚拟通道适用于多个节点连接向同一个中间节点的情形，节点都可以连接到一个不受信任的中间节点，然后节点和节点之间建立私有通道进行交易。重要的是，节点可以通过主链的问题挑战收回质押的金额，即使其他节点甚至中间节点都掉线了。

一般情况下，虚拟通道会允许两个节点在任何网络拓扑的结构下打开。

## 相关背景

在目前的区块链生态中，状态通道经常是这样几个步骤：

- 通过链上交易建立关系，并且质押金额
- 通过通道进行交易、交换金额
- 通过链上交易关闭通道，完成质押金额的转移

在之前的文章中，我们已经描述了如何组织通道的结构，以及通过账本通道从一个通道转移金额到另一个通道上。这些架构有一个限制，就是必须通过链上交易建立直接的关系。如果两个节点想要进行交易但没有提前打开通道，这两个节点就需要和合约进行交易并且质押金额进去。












Reference: [Virtual channels: creating a state channel network](https://blog.statechannels.org/virtual-channels/)

